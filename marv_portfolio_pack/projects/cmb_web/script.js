const cv=document.getElementById('plot'),ctx=cv.getContext('2d');const lmaxEl=document.getElementById('lmax'),AsEl=document.getElementById('As'),nsEl=document.getElementById('ns');document.getElementById('reset').onclick=()=>{lmaxEl.value=1500;AsEl.value=2.1e-9;nsEl.value=0.965;draw()};function sachsWolfe(ell,As,ns){return As*Math.pow(Math.max(ell,1),ns-3.0)}function compute(){const lmax=+lmaxEl.value,As=+AsEl.value,ns=+nsEl.value;const ell=Array.from({length:lmax-1},(_,i)=>i+2);const Dl=ell.map(l=>l*(l+1)*sachsWolfe(l,As,ns)/(2*Math.PI));return {ell,Dl,As,ns,lmax}}function draw(){const {ell,Dl}=compute();ctx.clearRect(0,0,cv.width,cv.height);const pad=50,w=cv.width-2*pad,h=cv.height-2*pad;ctx.strokeStyle='#1a2240';ctx.fillStyle='#cfe1ff';ctx.lineWidth=1;ctx.strokeRect(pad,pad,w,h);const xmin=ell[0],xmax=ell[ell.length-1];const ymin=Math.min(...Dl.filter(x=>x>0))*0.9,ymax=Math.max(...Dl)*1.2;const lx=(x)=>pad+(Math.log10(x)-Math.log10(xmin))/(Math.log10(xmax)-Math.log10(xmin))*w;const ly=(y)=>pad+(1-(Math.log10(y)-Math.log10(ymin))/(Math.log10(ymax)-Math.log10(ymin)))*h;ctx.beginPath();ctx.strokeStyle='#5ea0ff';ctx.lineWidth=2;for(let i=0;i<ell.length;i++){const x=lx(ell[i]),y=ly(Dl[i]);if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y)}ctx.stroke();ctx.fillStyle='#bcd0ff';ctx.fillText('ℓ (log)',pad+w/2-20,cv.height-10);ctx.save();ctx.translate(15,pad+h/2+20);ctx.rotate(-Math.PI/2);ctx.fillText('D_ℓ (log)',0,0);ctx.restore()}[lmaxEl,AsEl,nsEl].forEach(el=>el.addEventListener('input',draw));draw();